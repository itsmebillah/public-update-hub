const express = require('express');
const cors = require('cors');

const app = express();
const PORT = process.env.PORT || 8080; // Railway auto PORT set ржХрж░ржмрзЗ

app.use(cors());
app.use(express.json());

// ржбрзЗржорзЛ ржбрж╛ржЯрж╛
const updates = {
  hot: [
    { 
      id: 1, 
      title: "рзирзжрзирзк рж╕рж╛рж▓рзЗрж░ рж╕рж░ржХрж╛рж░рж┐ ржЫрзБржЯрж┐рж░ рждрж╛рж▓рж┐ржХрж╛ ржкрзНрж░ржХрж╛рж╢", 
      summary: "ржоржирзНрждрзНрж░рж┐ржкрж░рж┐рж╖ржж ржмрж┐ржнрж╛ржЧ рзирзжрзирзк рж╕рж╛рж▓рзЗрж░ рж╕рж░ржХрж╛рж░рж┐ ржЫрзБржЯрж┐рж░ рждрж╛рж▓рж┐ржХрж╛ ржкрзНрж░ржХрж╛рж╢ ржХрж░рзЗржЫрзЗред ржПрждрзЗ рззрзл ржжрж┐ржирзЗрж░ рж╕рж╛ржзрж╛рж░ржг ржЫрзБржЯрж┐ ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗред", 
      source: "ржоржирзНрждрзНрж░рж┐ржкрж░рж┐рж╖ржж ржмрж┐ржнрж╛ржЧ", 
      date: "рзирзжрзирзк-рзжрзз-рззрзл", 
      url: "https://cabinet.gov.bd",
      category: "hot"
    },
    { 
      id: 2, 
      title: "ржЗржирзНржЯрж╛рж░ржирзЗржЯ ржбрж╛ржЯрж╛ ржкрзНржпрж╛ржХрзЗрж░ ржжрж╛ржо ржХржорж╛ржирзЛ", 
      summary: "ржмрж┐ржЯрж┐ржЖрж░рж╕рж┐ ржорзЛржмрж╛ржЗрж▓ ржЗржирзНржЯрж╛рж░ржирзЗржЯ ржбрж╛ржЯрж╛ ржкрзНржпрж╛ржХрзЗрж░ ржжрж╛ржо рззрзж-рзирзж% ржХржорж╛ржирзЛрж░ рж╕рж┐ржжрзНржзрж╛ржирзНржд ржирж┐рзЯрзЗржЫрзЗред ржирждрзБржи ржорзВрж▓рзНржп рждрж╛рж▓рж┐ржХрж╛ ржЖржЧрж╛ржорзА рж╕ржкрзНрждрж╛рж╣ ржерзЗржХрзЗ ржХрж╛рж░рзНржпржХрж░ рж╣ржмрзЗред", 
      source: "ржмрж┐ржЯрж┐ржЖрж░рж╕рж┐", 
      date: "рзирзжрзирзк-рзжрзз-рззрзк", 
      url: "https://www.btrc.gov.bd",
      category: "hot"
    }
  ],
  jobs: [
    { 
      id: 3, 
      title: "ржмрж┐рж╕рж┐ржПрж╕ рзкрзлрждржо ржмрж╛рж░рзНрж╖рж┐ржХ ржкрж░рзАржХрзНрж╖рж╛рж░ ржмрж┐ржЬрзНржЮржкрзНрждрж┐", 
      summary: "ржмрж╛ржВрж▓рж╛ржжрзЗрж╢ рж╕рж┐ржнрж┐рж▓ рж╕рж╛рж░рзНржнрж┐рж╕ рзкрзлрждржо ржмрж╛рж░рзНрж╖рж┐ржХ ржкрж░рзАржХрзНрж╖рж╛рж░ ржмрж┐ржЬрзНржЮржкрзНрждрж┐ ржкрзНрж░ржХрж╛рж╢рж┐ржд рж╣рзЯрзЗржЫрзЗред ржЖржмрзЗржжржирзЗрж░ рж╢рзЗрж╖ рждрж╛рж░рж┐ржЦ рзйрзж ржЬрж╛ржирзБржпрж╝рж╛рж░рж┐ рзирзжрзирзкред", 
      source: "ржмрж┐рж╕рж┐ржПрж╕ ржХржорж┐рж╢ржи", 
      date: "рзирзжрзирзк-рзжрзз-рззрзж", 
      url: "https://www.bpsc.gov.bd",
      category: "job"
    },
    { 
      id: 4, 
      title: "рж╕рзЛржирж╛рж▓рзА ржмрзНржпрж╛ржВржХрзЗ ржЕржлрж┐рж╕рж╛рж░ ржирж┐рзЯрзЛржЧ", 
      summary: "рж╕рзЛржирж╛рж▓рзА ржмрзНржпрж╛ржВржХ рж▓рж┐ржорж┐ржЯрзЗржбрзЗ рж╕рж╣ржХрж╛рж░рзА ржЕржлрж┐рж╕рж╛рж░ ржкржжрзЗ рзирзжрзж ржЬржиржХрзЗ ржирж┐рзЯрзЛржЧрзЗрж░ ржмрж┐ржЬрзНржЮржкрзНрждрж┐ ржкрзНрж░ржХрж╛рж╢ ржХрж░рзЗржЫрзЗред ржЕржирж▓рж╛ржЗржирзЗ ржЖржмрзЗржжржи ржХрж░рж╛ ржпрж╛ржмрзЗред", 
      source: "рж╕рзЛржирж╛рж▓рзА ржмрзНржпрж╛ржВржХ", 
      date: "рзирзжрзирзк-рзжрзз-рззрзи", 
      url: "https://www.sonalibank.com.bd",
      category: "job"
    }
  ],
  education: [
    { 
      id: 5, 
      title: "ржПржЗржЪржПрж╕рж╕рж┐ ржкрж░рзАржХрзНрж╖рж╛рж░ рж░рзБржЯрж┐ржи ржкрзНрж░ржХрж╛рж╢", 
      summary: "рзирзжрзирзк рж╕рж╛рж▓рзЗрж░ ржПржЗржЪржПрж╕рж╕рж┐ ржУ рж╕ржоржорж╛ржирзЗрж░ ржкрж░рзАржХрзНрж╖рж╛рж░ рж░рзБржЯрж┐ржи ржкрзНрж░ржХрж╛рж╢ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗред ржкрж░рзАржХрзНрж╖рж╛ рж╢рзБрж░рзБ рж╣ржмрзЗ рзз ржПржкрзНрж░рж┐рж▓ ржерзЗржХрзЗред", 
      source: "рж╢рж┐ржХрзНрж╖рж╛ ржмрзЛрж░рзНржб", 
      date: "рзирзжрзирзк-рзжрзз-рззрзй", 
      url: "http://www.educationboardresults.gov.bd",
      category: "education"
    },
    { 
      id: 6, 
      title: "ржЬрж╛рждрзАржпрж╝ ржмрж┐рж╢рзНржмржмрж┐ржжрзНржпрж╛рж▓ржпрж╝рзЗрж░ ржЕржирж╛рж░рзНрж╕ ржкрж░рзАржХрзНрж╖рж╛ рж╕рзНржержЧрж┐ржд", 
      summary: "ржЬрж╛рждрзАржпрж╝ ржмрж┐рж╢рзНржмржмрж┐ржжрзНржпрж╛рж▓ржпрж╝рзЗрж░ ржЕржирж╛рж░рзНрж╕ ржЪрждрзБрж░рзНрже ржмрж░рзНрж╖рзЗрж░ ржирж┐рж░рзНржзрж╛рж░рж┐ржд ржкрж░рзАржХрзНрж╖рж╛ ржЕржЪрзЗрждрж╛ржмрж╕рзНржерж╛рж░ ржХрж╛рж░ржгрзЗ ржПржХ рж╕ржкрзНрждрж╛рж╣ ржкрж┐ржЫрж┐ржпрж╝рзЗ ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝рзЗржЫрзЗред", 
      source: "ржЬрж╛рждрзАржпрж╝ ржмрж┐рж╢рзНржмржмрж┐ржжрзНржпрж╛рж▓ржпрж╝", 
      date: "рзирзжрзирзк-рзжрзз-рззрзз", 
      url: "https://www.nu.ac.bd",
      category: "education"
    }
  ],
  government: [
    { 
      id: 7, 
      title: "ржбрж┐ржЬрж┐ржЯрж╛рж▓ рж╕рзЗржмрж╛ ржкрзНрж░рж╕рж╛рж░ржи ржкрзНрж░ржХрж▓рзНржк", 
      summary: "рждржерзНржп ржУ ржпрзЛржЧрж╛ржпрзЛржЧ ржкрзНрж░ржпрзБржХрзНрждрж┐ ржмрж┐ржнрж╛ржЧ ржбрж┐ржЬрж┐ржЯрж╛рж▓ рж╕рзЗржмрж╛ ржкрзНрж░рж╕рж╛рж░ржирзЗрж░ ржЬржирзНржп ржирждрзБржи ржкрзНрж░ржХрж▓рзНржк рж╣рж╛рждрзЗ ржирж┐рзЯрзЗржЫрзЗред рзлрзжрзжржЯрж┐ ржЗржЙржирж┐рзЯржирзЗ ржбрж┐ржЬрж┐ржЯрж╛рж▓ рж╕рзЗржирзНржЯрж╛рж░ рж╕рзНржерж╛ржкржи ржХрж░рж╛ рж╣ржмрзЗред", 
      source: "рждржерзНржп ржУ ржпрзЛржЧрж╛ржпрзЛржЧ ржкрзНрж░ржпрзБржХрзНрждрж┐ ржмрж┐ржнрж╛ржЧ", 
      date: "рзирзжрзирзк-рзжрзз-рзжрзп", 
      url: "https://ictd.gov.bd",
      category: "government"
    },
    { 
      id: 8, 
      title: "ржмрж┐ржжрзНржпрзБрзО ржмрж┐ржнрж╛ржЧрзЗрж░ ржирждрзБржи рж╕ржВржпрзЛржЧ ржирзАрждрж┐ржорж╛рж▓рж╛", 
      summary: "ржмрж┐ржжрзНржпрзБрзО ржмрж┐ржнрж╛ржЧ ржирждрзБржи рж╕ржВржпрзЛржЧрзЗрж░ ржЬржирзНржп рж╕рж╣ржЬрждрж░ ржирзАрждрж┐ржорж╛рж▓рж╛ ржЪрж╛рж▓рзБ ржХрж░рзЗржЫрзЗред ржПржЦржи ржЕржирж▓рж╛ржЗржирзЗ ржЖржмрзЗржжржи ржХрж░рзЗ рзн ржжрж┐ржирзЗрж░ ржоржзрзНржпрзЗ рж╕ржВржпрзЛржЧ ржкрж╛ржУрзЯрж╛ ржпрж╛ржмрзЗред", 
      source: "ржмрж┐ржжрзНржпрзБрзО ржмрж┐ржнрж╛ржЧ", 
      date: "рзирзжрзирзк-рзжрзз-рзжрзо", 
      url: "https://powerdivision.gov.bd",
      category: "government"
    }
  ]
};

// API routes
app.get('/', (req, res) => {
  res.json({
    message: "ЁЯЗзЁЯЗй ржмрж╛ржВрж▓рж╛ржжрзЗрж╢ ржЖржкржбрзЗржЯ API рж╕рж╛рж░рзНржнрж╛рж░",
    status: "running",
    server: "Railway.app",
    timestamp: new Date().toISOString(),
    endpoints: {
      "/api/hot": "рж╣ржЯ ржЖржкржбрзЗржЯ",
      "/api/jobs": "ржЪрж╛ржХрж░рж┐",
      "/api/education": "рж╢рж┐ржХрзНрж╖рж╛",
      "/api/government": "рж╕рж░ржХрж╛рж░рж┐",
      "/api/all": "рж╕ржм ржЖржкржбрзЗржЯ",
      "/api/health": "рж╕рж╛рж░рзНржнрж╛рж░ рж╣рзЗрж▓рже"
    }
  });
});

app.get('/api/hot', (req, res) => {
  res.json({
    success: true,
    category: "рж╣ржЯ ржЖржкржбрзЗржЯ",
    count: updates.hot.length,
    updates: updates.hot
  });
});

app.get('/api/jobs', (req, res) => {
  res.json({
    success: true,
    category: "ржЪрж╛ржХрж░рж┐",
    count: updates.jobs.length,
    updates: updates.jobs
  });
});

app.get('/api/education', (req, res) => {
  res.json({
    success: true,
    category: "рж╢рж┐ржХрзНрж╖рж╛",
    count: updates.education.length,
    updates: updates.education
  });
});

app.get('/api/government', (req, res) => {
  res.json({
    success: true,
    category: "рж╕рж░ржХрж╛рж░рж┐ ржирзЛржЯрж┐рж╢",
    count: updates.government.length,
    updates: updates.government
  });
});

app.get('/api/all', (req, res) => {
  const allUpdates = [...updates.hot, ...updates.jobs, ...updates.education, ...updates.government];
  res.json({
    success: true,
    count: allUpdates.length,
    updates: allUpdates
  });
});

app.get('/api/health', (req, res) => {
  res.json({
    status: "healthy",
    timestamp: new Date().toISOString(),
    server: "Railway.app",
    port: PORT
  });
});

// Error handling middleware
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).json({
    success: false,
    error: "Internal Server Error",
    message: err.message
  });
});

// 404 handler
app.use((req, res) => {
  res.status(404).json({
    success: false,
    error: "Not Found",
    message: "ржПржЗ API endpoint ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐"
  });
});

// Railway-specific: process.env.PORT ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗ
const serverPort = process.env.PORT || 3000;

app.listen(serverPort, '0.0.0.0', () => {
  console.log(`ЁЯЪА ржмрж╛ржВрж▓рж╛ржжрзЗрж╢ API рж╕рж╛рж░рзНржнрж╛рж░ ржЪрж▓ржЫрзЗ`);
  console.log(`ЁЯУб Port: ${serverPort}`);
  console.log(`ЁЯМР Railway URL: https://bangladesh-railway-api-production.up.railway.app`);
  console.log(`ЁЯСитАНЁЯТ╗ Local: http://localhost:${serverPort}`);
  console.log(`тЬЕ ржЯрзЗрж╕рзНржЯ: http://localhost:${serverPort}/api/hot`);
});

// Railway-ржПрж░ ржЬржирзНржп export
module.exports = app;
